<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="google-site-verification" content="Pcl6YtTgkvsBdA94IMfPgV3EaY3X8B1jCgZQ6s2bpo0" />
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">
  <meta name="bingbot" content="index, follow">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hidden Mechanics of Free Fire Beta Servers: How Internal Feature Flags Actually Control Your Game Experience</title>

  <!-- Meta description (requested) -->
  <meta name="description" content="Hidden Mechanics of Free Fire Beta Servers: How internal feature flags control what players see on Astute Beta Server. Detailed guide on feature flags, experiments, and why beta testing matters.">
  <link rel="icon" href="https://theastutebetaserver.com/wp-content/uploads/2025/10/cropped-cropped-Astute-Beta-Server-Favicon.webp" type="image/webp">
  <!-- Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Hidden Mechanics of Free Fire Beta Servers: How Internal Feature Flags Actually Control Your Game Experience",
      "description": "Hidden Mechanics of Free Fire Beta Servers: How internal feature flags control what players see on Astute Beta Server. Detailed guide on feature flags, experiments, and why beta testing matters.",
      "url": "https://loganhayes2.github.io/theastutebetaserver/",
      "image": "https://theastutebetaserver.com/wp-content/uploads/2025/10/cropped-cropped-Astute-Beta-Server-Favicon.webp",
      "publisher": {
        "@type": "Organization",
        "name": "theastutebetaserver"
      }
    }
    </script>
  <style>
    :root{
      --page-bg: #f4f6f9;
      --container-bg: #ffffff;
      --accent: #F1D306; /* table header color per request */
      --muted: #6b7280;
      --text: #0f1724;
      --header-footer-bg: #000000; /* requested */
      --header-footer-text: #ffffff; /* requested */
      --radius: 12px;
      --max-width: 1100px;
      --container-padding: 32px;
      font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    html,body{height:100%;margin:0;background:var(--page-bg);color:var(--text);}

    /* Header */
    header.site-header{
      background: var(--header-footer-bg);
      color: var(--header-footer-text);
      padding: 18px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.12);
      position: sticky;
      top: 0;
      z-index: 60;
    }
    header .inner{
      width:92%;
      max-width:var(--max-width);
      margin:0 auto;
      display:flex;
      align-items:center;
      gap:18px;
      justify-content:space-between;
    }
    header .site-title{
      margin:0;
      font-size:18px;
      font-weight:700;
      color:var(--header-footer-text);
    }
    header nav a{
      color:var(--header-footer-text);
      text-decoration:none;
      margin-left:14px;
      font-weight:600;
      opacity:0.95;
    }

    /* spacer between header and container */
    .page-spacer{height:12px;}

    /* Main container */
    .container{
      width:92%;
      max-width:var(--max-width);
      margin: 16px auto;
      background: var(--container-bg);
      padding: var(--container-padding);
      border-radius: var(--radius);
      box-shadow: 0 14px 40px rgba(14,20,30,0.08);
      overflow:hidden;
    }

    /* Top meta area */
    .meta{
      color:var(--muted);
      font-size:14px;
      margin-top:8px;
    }

    /* Article typography */
    article {
      font-size:18px;
      line-height:1.72;
      color:var(--text);
    }

    article h1{
      font-size:28px;
      margin: 6px 0 8px 0;
      color:var(--text);
      line-height:1.12;
      font-weight:800;
    }
    article h2{
      font-size:22px;
      margin-top:28px;
      margin-bottom:10px;
      color:var(--text);
      font-weight:700;
    }
    article h3{
      font-size:18px;
      margin-top:20px;
      margin-bottom:8px;
      font-weight:700;
    }
    article p{margin:12px 0;}
    article img{max-width:100%;height:auto;border-radius:8px;display:block;margin:12px 0;}

    /* Tables: header color #F1D306 */
    table{
      width:100%;
      border-collapse:collapse;
      margin:18px 0;
      background:transparent;
    }
    table th, table td{
      border:1px solid rgba(15,23,36,0.06);
      padding:10px 12px;
      text-align:left;
      vertical-align:top;
      font-size:15px;
    }
    table th{
      background: var(--accent);
      color: #000;
      font-weight:700;
    }

    /* TOC: foldable/collapsible */
    .toc-wrap{
      display:flex;
      gap:12px;
      align-items:flex-start;
      margin:18px 0;
      flex-direction:column;
    }
    .toc-controls{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .toc-toggle-btn{
      background:#000;
      color:#fff;
      border:none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
    }
    .toc{
      border-left:4px solid var(--accent);
      background:linear-gradient(180deg, rgba(241,211,6,0.06), rgba(241,211,6,0.02));
      padding:12px 14px;
      border-radius:8px;
      width:100%;
      box-sizing:border-box;
    }
    .toc h4{margin:0 0 8px 0;font-size:16px;}
    .toc ul{margin:0;padding-left:18px; max-height:420px; overflow:auto;}
    .toc a{color:var(--text); text-decoration:none; font-size:15px; display:block; padding:6px 0;}
    .toc a:hover{color: #0a58ca; text-decoration:underline;}
    .toc .sub-list{padding-left:12px; margin-top:6px;}

    /* Collapsible H2 items inside TOC */
    .toc-item{display:flex;align-items:center;justify-content:space-between;}
    .toc-item button {
      background:transparent;
      border:0;
      cursor:pointer;
      font-size:14px;
      padding:6px;
    }

    /* FAQ accordion style (optional) */
    .faq-qa h3{
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin:10px 0 6px 0;
      padding:10px;
      background:#f7f8fb;
      border-radius:8px;
    }
    .faq-qa p.answer{margin:8px 0 14px 0;padding:0 12px;color:#222;display:none;}
    .faq-qa .open p.answer{display:block;}

    /* small badge area */
    .extras{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
    .badge{background:#f1f5f9;padding:8px 12px;border-radius:999px;font-size:13px;color:#0f1724;}

    /* Footer */
    footer.site-footer{
      background: var(--header-footer-bg);
      color: var(--header-footer-text);
      padding:18px 0;
      margin-top:18px;
      text-align:center;
      font-size:15px;
    }

    /* Responsive */
    @media (max-width:880px){
      .container{padding:22px;}
      article h1{font-size:22px;}
      article h2{font-size:20px;}
      article{font-size:16px;line-height:1.6;}
      .toc{max-height:260px;}
    }

    /* Accessibility focus */
    a:focus, button:focus { outline: 3px solid rgba(11,92,255,0.14); outline-offset:3px; border-radius:6px; }

    /* Smooth anchor scroll: adjust for sticky header */
    html { scroll-behavior: smooth; }
    :target { scroll-margin-top: 86px; } /* header height offset */
  </style>
</head>
<body>

  <!-- Header with article title -->
  <header class="site-header" role="banner" aria-label="Site header">
    <div class="inner">
      <h1 class="site-title">Hidden Mechanics of Free Fire Beta Servers: How Internal Feature Flags Actually Control Your Game Experience</h1>
      
    </div>
  </header>

  <div class="page-spacer" aria-hidden="true"></div>

  <!-- Main content -->
  <main class="container" role="main" aria-labelledby="main-title">

    <article id="article-content" aria-live="polite">

      <!-- Intro & first paragraphs (unchanged) -->

      <p>Free Fire’s gameplay feels smooth, polished, and surprisingly balanced-even when huge updates drop globally. But behind this polished experience lies a complex world that most players never see. While the Astute Beta Server APK gives early access to new features, weapons, maps, and Evo gun updates, there is an even deeper layer powering everything: feature flags. <a href="https://theastutebetaserver.com/">https://theastutebetaserver.com/</a></p>

      <p>Feature flags determine what appears in your game, what remains hidden, and what gets tested silently in the background. Most players assume developers manually push updates every time features change, but the truth is far smarter and more controlled. <img src="https://theastutebetaserver.com/wp-content/uploads/2025/11/Astute-Beta-Server-1024x576.webp" alt="astute beta server" width="1000" height="600"></p>

      <p>In this detailed guide, you’ll learn how these hidden switches work, how they control your beta experience, and why the <a href="https://theastutebetaserver.pages.dev/">Astute Beta Server</a> relies heavily on this system. If you love understanding the “science behind Free Fire,” this is the article you have been waiting for.</p>

      <!-- Table of Contents inserted here (after intro paragraphs and before first H2) -->
      <div class="toc-wrap" aria-hidden="false">
        <div class="toc-controls">
          <button id="toc-toggle" class="toc-toggle-btn" aria-expanded="true">Hide TOC</button>
         
        </div>

        <nav id="toc" class="toc" aria-label="Table of contents">
          <h4>Contents</h4>
          <ul id="toc-list" aria-live="polite" role="list">
            <!-- JS will populate this with H2/H3 -->
          </ul>
        </nav>
      </div>

      <!-- Now the rest of the article, with headings converted to semantic tags -->
      <h2 id="what-are-feature-flags">What Are Feature Flags? (And Why You Should Care)</h2>

      <p>Feature flags are internal switches used by developers to turn features ON or OFF without releasing a new update.</p>

      <p> Think of them as remote controls that allow game developers to:</p>

      <ul>
        <li>Activate new features only for beta testers</li>
        <li>Test weapons silently on small user groups</li>
        <li>Disable features instantly if bugs appear</li>
        <li>Run A/B experiments without updating the entire game</li>
        <li>Change game mechanics live</li>
      </ul>

      <p>In beta servers like Astute Beta Server, feature flags are the backbone that makes early testing possible.</p>

      <h2 id="how-feature-flags-control">How Feature Flags Control Your Beta Experience</h2>

      <p>Whenever you download Astute Beta Server, your game is built on the same core engine as the official Free Fire, but the difference lies in what is activated.</p>

      <p>Here's what feature flags quietly control:</p>

      <h3 id="weapons-damage">1. New Weapons &amp; Damage Algorithms</h3>

      <p>Developers assign each upcoming weapon a flag:</p>

      <ul>
        <li>Damage ON/OFF</li>
        <li>Accuracy ON/OFF</li>
        <li>Recoil test mode</li>
        <li>Animation variant testing</li>
      </ul>

      <p>This allows them to test 3–4 versions of the same weapon without releasing separate APKs.</p>

      <h3 id="character-abilities">2. New Character Abilities</h3>

      <p>Character skills are tested in hidden phases:</p>

      <ul>
        <li>Phase A testing: 50% skill effectiveness</li>
        <li>Phase B testing: 70% skill effectiveness</li>
        <li>Phase C testing: Full ability unlocked</li>
      </ul>

      <p>Your version depends on which experiment you’re placed in.</p>

      <h3 id="map-layouts">3. Map Layout Adjustments</h3>

      <p>Before a new map or zone release, flags control:</p>

      <ul>
        <li>Spawn points</li>
        <li>Loot distribution</li>
        <li>Enemy density</li>
        <li>Fog, blur, and lighting tests</li>
      </ul>

      <p>Beta users often don’t realize they are experiencing different variants than others.</p>

      <h3 id="graphics-changes">4. Hidden Graphics Changes</h3>

      <p>Sometimes your graphics look sharper-or worse.</p>

      <p> This is because developers test:</p>

      <ul>
        <li>Color grading filters</li>
        <li>Hit-marker visibility</li>
        <li>FPS stabilization flags</li>
        <li>Shadow variations</li>
      </ul>

      <h3 id="monetization">5. Monetization Testing (But FREE in Beta Server)</h3>

      <p>In the real Free Fire, developers test:</p>

      <ul>
        <li>Pricing models</li>
        <li>Diamond reward systems</li>
        <li>Luck Royale optimization</li>
      </ul>

      <p>But in beta servers, everything remains free, yet the underlying tests continue.</p>

      <h2 id="table-difference">Table: Difference Between Normal Free Fire &amp; Beta Server Feature Control</h2>

      <table aria-describedby="table-diff-desc">
        <caption id="table-diff-desc" style="caption-side:top;text-align:left;padding-bottom:8px;font-weight:700;">System comparison</caption>
        <thead>
          <tr>
            <th>System</th>
            <th>Normal Free Fire</th>
            <th>Astute Beta Server</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Feature Flags</td>
            <td>Only enabled after stability tests</td>
            <td>Activated instantly for experiments</td>
          </tr>
          <tr>
            <td>Bugs</td>
            <td>Fixed before public rollout</td>
            <td>Actively present, monitored</td>
          </tr>
          <tr>
            <td>User Feedback</td>
            <td>Optional, slow impact</td>
            <td>Direct rapid changes</td>
          </tr>
          <tr>
            <td>Weapon Testing</td>
            <td>Hidden from public</td>
            <td>Fully visible + free access</td>
          </tr>
          <tr>
            <td>Character Release</td>
            <td>After global event</td>
            <td>2-4 weeks earlier</td>
          </tr>
          <tr>
            <td>Maps</td>
            <td>Release only after final build</td>
            <td>Early testing builds</td>
          </tr>
          <tr>
            <td>Configuration</td>
            <td>Stable</td>
            <td>Highly experimental</td>
          </tr>
        </tbody>
      </table>

      <h2 id="why-free-fire-depends">Why Free Fire Depends Heavily on Feature Flags</h2>

      <p>1. To Prevent Game-Breaking Crashes</p>

      <p>Imagine releasing a new map that crashes on 20% of devices. Instead of removing the map globally, a feature flag disables it instantly.</p>

      <p>2. To Avoid Updating the App Every Week</p>

      <p>Developers cannot release frequent updates on Play Store.</p>

      <p> Feature flags solve this by:</p>

      <ul>
        <li>Turning features ON/OFF instantly</li>
        <li>Sharing updates without reinstallation</li>
      </ul>

      <p>3. To Run A/B Testing Without Notifying Players</p>

      <p>Free Fire tests:</p>

      <ul>
        <li>Weapon recoil</li>
        <li>Drop rates</li>
        <li>Skill cooldowns</li>
        <li>Aim assist adjustments</li>
      </ul>

      <p>4. To Collect Real Behavior Data</p>

      <p>Instead of relying on predictions, they see:</p>

      <ul>
        <li>How long users stay in new modes</li>
        <li>Which weapons are overpowered</li>
        <li>Which maps users avoid</li>
        <li>Where players die the most</li>
      </ul>

      <p>This ensures accurate balancing.</p>

      <h2 id="how-astute-uses">How Astute Beta Server Uses Feature Flags Differently</h2>

      <p>Astute Beta Server gives testers more freedom and deeper visibility into upcoming content because:</p>

      <ul>
        <li> Every new feature is exposed immediately
          <br> No restrictions, delays, or hidden controls.</li>
        <li> Multiple variants can be tested at once
          <br> Two versions of a gun? Three?
           Beta makes it possible.</li>
        <li> Bugs get recorded automatically
          <br> Flags integrate with log tracking, making developer analysis easier.</li>
        <li> Developers receive feedback within hours
          <br> Your bug report triggers instant adjustments.</li>
      </ul>

      <h2 id="hidden-experiments">Hidden Experiments You Never Knew You Were Part Of</h2>

      <p>Most Free Fire players unknowingly participate in controlled experiments.</p>

      <p>Here are rare mechanics tested silently:</p>

      <h3 id="dynamic-damage">1. Dynamic Damage Scaling</h3>
      <p>Your gun sometimes feels stronger or weaker due to live server adjustments.</p>

      <h3 id="silent-aim">2. Silent Aim Assist Calibration</h3>
      <p>Aim assist may change every few hours for testing.</p>

      <h3 id="matchmaking-tests">3. Matchmaking Stress Tests</h3>
      <p>Developers test:</p>
      <ul>
        <li>Short queue times</li>
        <li>High-intensity lobbies</li>
        <li>Region switching</li>
      </ul>

      <h3 id="movement-optimization">4. Movement Optimization</h3>
      <p>Running, crouching, sliding sometimes feel different because movement physics are updated silently.</p>

      <h2 id="table-top-experiments">Table: Top Feature Flag Experiments Done in Free Fire</h2>

      <table aria-describedby="table-top-desc">
        <caption id="table-top-desc" style="caption-side:top;text-align:left;padding-bottom:8px;font-weight:700;">Top experiments</caption>
        <thead>
          <tr>
            <th>Experiment Type</th>
            <th>Purpose</th>
            <th>Impact on Player</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Weapon balancing</td>
            <td>Control OP weapons</td>
            <td>Damage fluctuations</td>
          </tr>
          <tr>
            <td>Mode testing</td>
            <td>Check popularity</td>
            <td>Some modes appear/disappear</td>
          </tr>
          <tr>
            <td>UI redesigns</td>
            <td>Improve gameplay</td>
            <td>Button changes</td>
          </tr>
          <tr>
            <td>Character ability tuning</td>
            <td>Balance unfair matchups</td>
            <td>Skill cooldown changes</td>
          </tr>
          <tr>
            <td>Loot distribution</td>
            <td>Add fairness</td>
            <td>Better loot in some zones</td>
          </tr>
          <tr>
            <td>FPS throttling</td>
            <td>Stabilize low devices</td>
            <td>Smoother performance</td>
          </tr>
        </tbody>
      </table>

      <h2 id="how-testers-influence">How Beta Testers Accidentally Influence the Final Game</h2>

      <p>Most players don't realize the power they hold.</p>

      <p>Your usage data determines:</p>

      <ul>
        <li>Which weapons get buffed</li>
        <li>Which characters get nerfed</li>
        <li>Which maps become official</li>
        <li>Which modes are removed permanently</li>
      </ul>

      <p>The more you test, the more you influence Free Fire’s future.</p>

      <h2 id="why-developers-prefer">Why Developers Prefer Astute Beta Server Over Internal Tools</h2>

      <ol>
        <li>Real Player Behavior
          <br> Humans behave unpredictably; internal teams don’t.</li>
        <li>Device Diversity
          <br> Millions of device types → unlimited test environments.</li>
        <li>Genuine Bug Discovery
          <br> Players find bugs developers never think of.</li>
        <li>Community Feedback
          <br> Instant, real-world opinions.</li>
      </ol>

      <!-- FAQ: questions converted to h3 and answers preserved -->
      <h2 id="faqs">FAQs</h2>

      <div class="faq-qa" id="faq-list">
        <h3>1. Does Astute Beta Server really influence the global Free Fire version?</h3>
        <p class="answer">YES. Feedback and data from beta testers directly shape weapon balance, character abilities, and map updates.</p>

        <h3>2. Are feature flags visible to normal players?</h3>
        <p class="answer">No. They operate silently in the background.</p>

        <h3>3. Why does the beta server feel different for some users?</h3>
        <p class="answer">Because multiple experimental variants are often tested simultaneously.</p>

        <h3>4. Do beta testers get rewards?</h3>
        <p class="answer">In most cases, testers are rewarded indirectly through improved gameplay—and sometimes through early gifts depending on the version.</p>

        <h3>5. Can feature flags break the game?</h3>
        <p class="answer">Yes, which is why beta environments are used before public rollout.</p>
      </div>

      <h2 id="conclusion">Conclusion</h2>

      <p>Feature flags are the hidden backbone of the Free Fire and Astute Beta Server ecosystems. They control everything-from which weapons you see, to how the map behaves, to which characters feel overpowered. Without them, updates would be slow, buggy, and risky to release globally.</p>

      <p>Astute Beta Server gives players a rare opportunity to experience these features before anyone else, participate in early testing, and shape the future of the game. Understanding these hidden mechanics gives you a deeper appreciation of how Free Fire operates and why beta testing is more important than most players realize.</p>

    </article>

  
  </main>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    © 2025 Astute Beta Server
  </footer>

  <!-- JS: Build TOC, make TOC foldable, smooth scroll offset, FAQ accordion behavior, word/char counts -->
  <script>
    (function(){
      const article = document.getElementById('article-content');
      const tocList = document.getElementById('toc-list');
      const tocToggle = document.getElementById('toc-toggle');

      if (!article) return;

      // Build TOC from H2 & H3
      const headings = article.querySelectorAll('h2, h3');
      const tocData = [];
      headings.forEach(h => {
        // ensure id exists
        if (!h.id) {
          h.id = h.textContent.trim().toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]+/g,'');
        }
        const level = h.tagName.toLowerCase() === 'h2' ? 2 : 3;
        tocData.push({id: h.id, text: h.textContent.trim(), level});
      });

      // create nested list structure: H2 parent, H3 children
      tocData.forEach(item => {
        if (item.level === 2) {
          const li = document.createElement('li');
          li.className = 'toc-parent';
          // parent container with expand/collapse control
          const wrapper = document.createElement('div');
          wrapper.className = 'toc-item';
          const link = document.createElement('a');
          link.href = '#' + item.id;
          link.textContent = item.text;
          link.setAttribute('data-target', item.id);
          link.style.fontWeight = '700';
          wrapper.appendChild(link);

          const btn = document.createElement('button');
          btn.innerHTML = '▾';
          btn.setAttribute('aria-expanded', 'true');
          btn.title = 'Collapse / Expand';
          btn.addEventListener('click', function(e){
            const sub = li.querySelector('.sub-list');
            if (!sub) return;
            const isOpen = sub.style.display !== 'none';
            sub.style.display = isOpen ? 'none' : 'block';
            btn.innerHTML = isOpen ? '▸' : '▾';
            btn.setAttribute('aria-expanded', String(!isOpen));
            e.preventDefault();
          });
          wrapper.appendChild(btn);
          li.appendChild(wrapper);

          const subUl = document.createElement('ul');
          subUl.className = 'sub-list';
          subUl.style.margin = '6px 0 8px 12px';
          subUl.style.paddingLeft = '0';
          li.appendChild(subUl);
          tocList.appendChild(li);
        } else {
          // find last parent li to append child
          const parents = tocList.querySelectorAll('.toc-parent');
          const lastParent = parents[parents.length - 1];
          if (lastParent) {
            const subUl = lastParent.querySelector('.sub-list');
            const childLi = document.createElement('li');
            childLi.style.listStyle = 'none';
            const childLink = document.createElement('a');
            childLink.href = '#' + item.id;
            childLink.textContent = item.text;
            childLink.style.fontWeight = '400';
            childLi.appendChild(childLink);
            subUl.appendChild(childLi);
          } else {
            // no parent yet — append as top-level
            const li = document.createElement('li');
            const link = document.createElement('a');
            link.href = '#' + item.id;
            link.textContent = item.text;
            li.appendChild(link);
            tocList.appendChild(li);
          }
        }
      });

      // TOC toggle (show/hide entire TOC)
      if (tocToggle) {
        tocToggle.addEventListener('click', function(){
          const toc = document.getElementById('toc');
          if (!toc) return;
          const isHidden = toc.style.display === 'none';
          toc.style.display = isHidden ? 'block' : 'none';
          tocToggle.textContent = isHidden ? 'Hide TOC' : 'Show TOC';
          tocToggle.setAttribute('aria-expanded', String(isHidden));
        });
      }

      // Smooth scroll: offset for sticky header
      function scrollToId(id) {
        const el = document.getElementById(id);
        if (!el) return;
        const headerOffset = 86; // approx header height
        const elementPosition = el.getBoundingClientRect().top + window.pageYOffset;
        const offsetPosition = elementPosition - headerOffset;
        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });
      }

      // Intercept TOC links to use offset scroll
      tocList.querySelectorAll('a').forEach(a => {
        a.addEventListener('click', function(e){
          const target = this.getAttribute('href').slice(1);
          if (!target) return;
          e.preventDefault();
          scrollToId(target);
          // update hash without jumping instantly
          history.replaceState(null, '', '#' + target);
        });
      });

      // Also make regular article links with hash use offset scroll
      article.querySelectorAll('a[href^="#"]').forEach(a => {
        a.addEventListener('click', function(e){
          const target = this.getAttribute('href').slice(1);
          if (!target) return;
          e.preventDefault();
          scrollToId(target);
          history.replaceState(null, '', '#' + target);
        });
      });

      // FAQ accordion behavior: toggle answers on H3 click within faq-qa
      const faqWrapper = document.getElementById('faq-list');
      if (faqWrapper) {
        const faqHeaders = faqWrapper.querySelectorAll('h3');
        faqHeaders.forEach(h => {
          h.setAttribute('tabindex', '0');
          const answer = h.nextElementSibling;
          if (answer && answer.classList.contains('answer')) {
            // initially collapsed
            answer.style.display = 'none';
            h.addEventListener('click', function(){
              const showing = answer.style.display !== 'none';
              answer.style.display = showing ? 'none' : 'block';
              h.setAttribute('aria-expanded', String(!showing));
            });
            h.addEventListener('keydown', function(e){
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                h.click();
              }
            });
          }
        });
      }

      // Word & char counts
      const wcEl = document.getElementById('word-count');
      const ccEl = document.getElementById('char-count');
      const text = article.textContent || '';
      const charCount = text.length;
      const words = text.trim().length ? text.trim().split(/\s+/u) : [];
      const wordCount = words.length;
      if (wcEl) wcEl.textContent = 'Words: ' + wordCount;
      if (ccEl) ccEl.textContent = 'Characters: ' + charCount;

      // Make TOC sticky on small screens when collapsed (optional)
      // (CSS handles appearance; this keeps behavior simple)

      // Expand all TOC parents by default — button can collapse them
      // (already set to show; collapse buttons exist per parent)
    })();
  </script>
</body>
</html>
